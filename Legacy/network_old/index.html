<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Legacy/network_old">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Network Specification | Attorney Online</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/Legacy/network_old"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Network Specification | Attorney Online"><meta data-rh="true" name="description" content="The following document covers how 1.7.5, 1.8 and 2.3.0+ versions of AO clients connect and communicate with servers."><meta data-rh="true" property="og:description" content="The following document covers how 1.7.5, 1.8 and 2.3.0+ versions of AO clients connect and communicate with servers."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/Legacy/network_old"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/Legacy/network_old" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/Legacy/network_old" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.60e5673a.css">
<link rel="preload" href="/assets/js/runtime~main.531649e4.js" as="script">
<link rel="preload" href="/assets/js/main.cb411173.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/favicon.ico" alt="Attorney Online Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/favicon.ico" alt="Attorney Online Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Attorney Online</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/Authoring/">Authoring</a><button aria-label="Toggle the collapsible sidebar category &#x27;Authoring&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Development/Network">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Gameplay/Casing">Gameplay</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/Legacy/loading_1.0">Legacy</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Legacy/loading_1.0">loading_1.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/Legacy/loading_2.0">loading_2.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/Legacy/network_old">Network Specification</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/Server/Server Rewrite">Server</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Documentation</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Legacy</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Network Specification</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Network Specification</h1><p>The following document covers how 1.7.5, 1.8 and 2.3.0+ versions of AO clients connect and communicate with servers.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="legend">Legend<a class="hash-link" href="#legend" title="Direct link to heading">â€‹</a></h2><p>AO = Attorney Online<br>
<!-- -->char = character, as in the game character, not the char datatype<br>
<!-- -->type(x) = an array of type separated by x: typextypextype<br>
<!-- -->C = client<br>
<!-- -->S = server<br>
<!-- -->[x]<!-- --> = x is an optional argument(usually used by version 2.3.0+)<br>
<!-- -->{x} = x is encrypted using the &quot;fantacrypt&quot; algorithm  </p><h1>FantaCrypt</h1><p>AO1.x encrypted the headers of the packets sent by the client to the server.
FantaCrypt works by seeding a PRNG with a known value (the decryption key).
The lower two bytes are the only ones that are used in the PRNG.
Additionally, only the upper byte of those two bytes are used in the cipher.
The current key is XOR&#x27;ed with the current byte.
To get the key value for the next byte, the byte and key are added together.
Then, some multiplication and addition is done to that value.
This PRNG behavior is similar to a Linear Congruential Generator.
Finally, everything but the lower two bytes are discarded.
However, there was a major flaw in the implementation of FantaCrypt.
The server supplies the client with the initial key to use for every packet.
Thus, it is totally vulnerable to a replay atttack.
Many clients do not actually even implement the FantaCrypt algorithm, but instead
they use a hardcoded key of 5, which is sent as 0x34 in the &#x27;decryptor&#x27; packet.
This is because the &#x27;decryptor&#x27; packet argument is the key to be used, but encrypted.
The decryptor value is always encrypted with a magic number key value: 322 decimal.
FantaCrypt is only used in messages sent by the client to the server, as well.</p><h1>Handshake</h1><p>The handshake is largely the same regardless of server and client version.  </p><p>C: (ordinary TCP handshake)<br>
<!-- -->S: <strong>decryptor#{&lt;decryptor: hex&gt;}#%</strong> (the argument is decrypted using <strong>unsigned integer</strong> 322 as decryption key)<br>
<!-- -->(all headers from the client are encrypted from here on)*<br>
<!-- -->C: <strong>HI#&lt;unique_hardware_id: string&gt;#%</strong><br>
<!-- -->S: <strong>ID#&lt;player_id: int&gt;#&lt;software: string&gt;<!-- -->[#&lt;version: int.int.int&gt;]<!-- -->#%</strong> (player id is largely unused)<br>
<!-- -->[C: <strong>ID#&lt;software: string&gt;#&lt;version: int.int.int&gt;#%</strong>]<br>
<!-- -->S: <strong>PN#&lt;player_count :int&gt;#&lt;max_players: int&gt;#%</strong><br>
<!-- -->[S: <strong>FL#&lt;feature1: string&gt;#...#&lt;featureN: string&gt;#%</strong>]<!-- -->  </p><p>*: not always true, if the server sends noencryption as an argument in the FL packet, headers are no longer encrypted(2.3.1+ only)  </p><h1>Loading</h1><p>Loading is the process where the server sends lists of its characters, music and sometimes evidence to the client. A prerequisite of loading is a successful handshake with a server.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="loading-10">Loading 1.0<a class="hash-link" href="#loading-10" title="Direct link to heading">â€‹</a></h2><p>Used by versions 1.8 and 1.7.5, this loading is very inefficient and suffers heavily from latency. Can also be used by 2.3.0+ in cases where the server does not support fast loading.  </p><p>C: <strong>askchaa#%</strong><br>
<!-- -->S: <strong>SI#&lt;char_list_length: int&gt;#&lt;evidence_list_length: int&gt;#&lt;music_list_length: int&gt;#%</strong><br>
<!-- -->C: <strong>askchar2#%</strong><br>
<!-- -->S: <strong>CI#&lt;char_id: int&gt;#&lt;char_name: string&gt;&amp;&lt;description: string&gt;&amp;&lt;?: int&gt;&amp;&lt;evidence: int(,)&gt;&amp;&amp;&lt;?: int&gt;&amp;#...#%</strong>  (1-10 in every packet, continued in the ...)<br>
<!-- -->C: <strong>AN#1#%</strong><br>
<!-- -->S: <strong>CI#...#%</strong><br>
<!-- -->C: <strong>AN#2#%</strong><br>
<!-- -->...<br>
<!-- -->S: <strong>EI#&lt;evidence_id: int&gt;#&lt;evidence_name: string&gt;&amp;&lt;evidence_description: string&gt;&amp;1&amp;&lt;evidence_image_name: string&gt;&amp;##%</strong>  (evidence loads one at a time)<br>
<!-- -->C: <strong>AE#1#%</strong><br>
<!-- -->S: <strong>EI#...#%</strong><br>
<!-- -->C: <strong>AE#2#%</strong><br>
<!-- -->...<br>
<!-- -->S: <strong>EM#&lt;music_id: int&gt;#&lt;music_name: string&gt;#...#% (music is also loaded in packs of 10)</strong><br>
<!-- -->C: <strong>AM#1#%</strong><br>
<!-- -->S: <strong>EM#...#%</strong><br>
<!-- -->C: <strong>AM#2#%</strong><br>
<!-- -->...<br>
<!-- -->S: <strong>CharsCheck#&lt;char_taken: int&gt;#...#%</strong> (same size as character list, 0 = free, -1 = taken)<br>
<!-- -->S: <strong>OPPASS#{&lt;mod_pass: hex&gt;}#%</strong> (an obsolete artifact of the disastrous security of old AO servers, still used on AO clients 1.8 and lower to display a guard checkbox in the client)<br>
<!-- -->S: <strong>DONE#%</strong>  </p><p>A sample can be found <a href="https://github.com/Attorney-Online-Engineering-Task-Force/Documentation/blob/master/Samples/Handshake%20%2B%20Loading%201.0%20Sample" target="_blank" rel="noopener noreferrer">here</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="loading-20">Loading 2.0<a class="hash-link" href="#loading-20" title="Direct link to heading">â€‹</a></h2><p>Designed to be <em>much</em> faster than Loading 1.0, most noticably on slow connections.</p><p>C: <strong>askchaa#%</strong><br>
<!-- -->S: <strong>SI#&lt;char_list_length: int&gt;#&lt;evidence_list_length: int&gt;#&lt;music_list_length: int&gt;#%</strong><br>
<!-- -->C: <strong>RC#%</strong><br>
<!-- -->S: <strong>SC#&lt;char_name: string&gt;<!-- -->[&amp;&lt;char_description: string&gt;]<!-- -->#...#%</strong> (contains the entire server character list)<br>
<!-- -->C: <strong>RM#%</strong><br>
<!-- -->S: <strong>SM#&lt;music_name: string&gt;#...#%</strong> (same as characters)<br>
<!-- -->C: <strong>RD#%</strong><br>
<!-- -->S: <strong>CharsCheck#&lt;char_taken: int&gt;#...#%</strong> (same size as character list, 0 = free, -1 = taken)<br>
<!-- -->S: <strong>OPPASS#{&lt;mod_pass: hex&gt;}#%</strong> (again, not the actual modpass)<br>
<!-- -->S: <strong>DONE#%</strong>  </p><p>What&#x27;s important to note here is that since the character and music lists often are way too large for a single packet, TCP chops it into smaller ones. It is the client&#x27;s responsiblity to piece them together on their end.(TCP makes sure that the segments will be handled in the correct order)  </p><p>A sample can be found <a href="https://github.com/Attorney-Online-Engineering-Task-Force/Documentation/blob/master/Samples/Handshake%20%2B%20Loading%202.0%20Sample" target="_blank" rel="noopener noreferrer">here</a></p><h1>Character picking</h1><p>C: <strong>PW#&lt;password: string&gt;#%</strong>
C: <strong>CC#&lt;player_id: int&gt;#&lt;char_id: int&gt;#&lt;unique_hardware_id: string&gt;#%</strong>
(there&#x27;s strictly speaking no need to verify player id serverside)
The password parameter is new in 2.7. In 1.7, character passwords were checked clientside and after that the feature was never reimplemented.
S: <strong>PV#&lt;player_id:  int&gt;#CID#&lt;char_id: int&gt;#%</strong> (the server indicates that a character was successfully picked)</p><h1>Messaging</h1><p>For the most part, communication between clients happens this way. There are chiefly two message types, IC messages and OOC messages.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ic-messages">IC messages<a class="hash-link" href="#ic-messages" title="Direct link to heading">â€‹</a></h2><p>IC messages, (abbreviation for &quot;In-character&quot;) are the kind of messages sent with a character, an animation and many other modifiers. There is a total of 14 arguments, which makes the packet a bit complex. To make this a bit more manageable, there is a redundant newline for every argument. These are not present in the actual packet.</p><p>C:
<strong>MS#<br>chat/0/1# (0 = no desk, 1 = desk)<br>&lt;pre_emote: string&gt;#<br>&lt;character: string&gt;#<br>&lt;emote: string&gt;#<br>&lt;message: unicode_string&gt;#<br>&lt;side: string&gt;#<br>&lt;sfx-name: string&gt;#<br>&lt;emote_modifier: int&gt;#<br>&lt;char_id: int&gt;#<br>&lt;sfx-delay: int&gt;#<br>&lt;shout_modifier: int&gt;#<br>&lt;evidence: int&gt;#<br>&lt;char_id2/flip: int&gt;#<br>&lt;realization: int&gt;#<br>&lt;text_color: int&gt;#<br>[&lt;showname: string&gt;]<!-- -->#<br>[&lt;other_charid: int&gt;]<!-- -->#<br>[&lt;self_offset: int&gt;]<!-- -->#<br>[&lt;noninterrupting_preanim: int&gt;]<!-- -->#%</strong>  </p><p>S:
<strong>MS#<br>chat/0/1# (0 = no desk, 1 = desk)<br>&lt;pre_emote: string&gt;#<br>&lt;character: string&gt;#<br>&lt;emote: string&gt;#<br>&lt;message: unicode_string&gt;#<br>&lt;side: string&gt;#<br>&lt;sfx-name: string&gt;#<br>&lt;emote_modifier: int&gt;#<br>&lt;char_id: int&gt;#<br>&lt;sfx-delay: int&gt;#<br>&lt;shout_modifier: int&gt;#<br>&lt;evidence: int&gt;#<br>&lt;char_id2/flip: int&gt;#<br>&lt;realization: int&gt;#<br>&lt;text_color: int&gt;#<br>[&lt;showname: string&gt;]<!-- -->#<br>[&lt;other_charid: int&gt;]<!-- -->#<br>[&lt;other_name: string&gt;]<!-- -->#<br>[&lt;other_emote: string&gt;]<!-- -->#<br>[&lt;self_offset: int&gt;]<!-- -->#<br>[&lt;other_offset: int&gt;]<!-- -->#<br>[&lt;other_flip: int&gt;]<!-- -->#<br>[&lt;noninterrupting_preanim: int&gt;]<!-- -->#%</strong>  </p><p>The following features have been added in 2.6 when the Case CafÃ© Custom Client features had been merged:</p><ul><li><code>showname</code>: If used, this will show a custom showname for the character.</li><li><code>other_charid</code>: The character ID of the person the users wishes to pair up with.</li><li><code>other_name</code>: This is actually the literal name of the character -- that is, its folder. This is sent over in case the user&#x27;s pair is iniswapping.</li><li><code>other_emote</code>: The emote the user&#x27;s pair was doing. Note that by default, zooms (that are correctly defined as such) do not update this value, so a pair of zooms will not appear. Zooms also enjoy special privileges, in that (assuming they are correctly defined, again) they make the pair disappear in the client, and get centered.</li><li><code>self_offset</code>: the percentage, going from <code>-100</code> (one whole screen&#x27;s worth to the left) to <code>100</code> (one whole screen&#x27;s worth to the right).</li><li><code>other_offset</code>: The user&#x27;s pair&#x27;s <code>self_offset</code>, basically.</li><li><code>other_flip</code>: The user&#x27;s pair&#x27;s <code>char_id2/flip</code>, basically.</li><li><code>noninterrupting_preanim</code>: If <code>1</code>, the preanimation plays at the same time as the text goes.</li></ul><p>Note that servers may overwrite specific values of this message. For example, disemvoweling and shaking modify your text, and <code>/force_nonint_pres</code> forces your preanims to be noninuterrupting.</p><p>For more information on valid arguments and client behavior, see <a href="https://github.com/Attorney-Online-Engineering-Task-Force/Attorney-Online-Client-Remake/wiki/In-character-chat-messages%5BMS%5D" target="_blank" rel="noopener noreferrer">this</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ooc-messages">OOC messages<a class="hash-link" href="#ooc-messages" title="Direct link to heading">â€‹</a></h2><p>OOC messages, (abbreviation for &quot;Out-of-character&quot;) are simple messages with a name and message associated with them. They&#x27;re used by servers to convey information and by users to not interrupt ongoing gameplay.  </p><p><strong>CT#&lt;name: string&gt;#&lt;message: string&gt;#<!-- -->[&lt;is_from_server: int&gt;]<!-- -->#%</strong></p><p>The <code>is_from_server</code> packet piece is an addition that arrived with 2.6.
If it is a <code>1</code>, the message sender&#x27;s name is coloured with the <code>ooc_server_color</code> as defined in the current theme.
Else, it is coloured with <code>ooc_default_color</code>.
This is used to make pretending to be the server and leaving messages in its name harder.</p><p>Generally, only the server adds the <code>is_from_server</code> part. It does not care if the client adds it, it will just ignore that.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="escape-codes">Escape Codes<a class="hash-link" href="#escape-codes" title="Direct link to heading">â€‹</a></h2><p>Escape codes allows characters like &#x27;#&#x27; to be sent in messages.</p><p>&#x27;%&#x27; = <code>&lt;percent&gt;</code><br>
<!-- -->&#x27;#&#x27; = <code>&lt;num&gt;</code><br>
<!-- -->&#x27;$&#x27; = <code>&lt;dollar&gt;</code><br>
<!-- -->&#x27;&amp;&#x27; = <code>&lt;and&gt;</code>  </p><h1>Music</h1><p>C: <strong>MC#&lt;songname: string&gt;#&lt;char_id: int&gt;#<!-- -->[&lt;showname: string&gt;]<!-- -->#%</strong><br>
<!-- -->S: (same)</p><p>Some servers support a looping feature where a song is played continuously, without receiving client music requests.</p><p>In 2.6, a <code>showname</code> piece is added to the end of this packet. This is for the chatlog to be able to correctly store and show who changed the music, so that it does not end up confusing when it does not refer to the user&#x27;s showname, but their character&#x27;s name.</p><h1>Area Switching</h1><p>C: <strong>MC#&lt;areaname: string&gt;#&lt;char_id: int&gt;#%</strong></p><p>The MC packet is reused for this purpose. Once received the server will send 2 HP&#x27;s, 1 BN, and 1 LE packets, to load the area info. After that it will start sending messages from the new area. If the area does not exist the packet is ignored.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="area-updates">Area updates<a class="hash-link" href="#area-updates" title="Direct link to heading">â€‹</a></h2><p>In 2.6, there is one further packet concerning areas.</p><p>S:
<strong>ARUP#0#&lt;area1_p: int&gt;#&lt;area2_p: int&gt;#...#%<br>ARUP#1#&lt;area1_s: string&gt;##&lt;area2_s: string&gt;#...#%<br>ARUP#2#&lt;area1_cm: string&gt;##&lt;area2_cm: string&gt;#...#%<br>ARUP#3#&lt;area1_l: string&gt;##&lt;area2_l: string&gt;#...#%</strong>  </p><p>Where the first argument is:</p><ul><li><code>0</code>, if it talks about playercount,</li><li><code>1</code>, if it talks about the area&#x27;s status,</li><li><code>2</code>, if it talks about the CM(s) of the area, and</li><li><code>3</code>, if it talks about the area being locked or not.</li></ul><p>This packet has as many pieces (plus one) as there are areas on the server. It describes, in order, every area&#x27;s given property. As an example, a packet of <code>ARUP#0#4#3#7#2#0#0#%</code> would mean that:</p><ul><li>There are 4 players in the first area (or in the zeroth area, actually)</li><li>There are 3 in the second,</li><li>There are 7 in the third,</li><li>There are 2 in the fourth,</li><li>And 0 in the last two.</li></ul><h1>Casing</h1><p>In the 2.6 update, a few packets have been introduced to supply casing needs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="case-preferences-update">Case preferences update<a class="hash-link" href="#case-preferences-update" title="Direct link to heading">â€‹</a></h2><p>This packet updates the user&#x27;s casing alert preferences.</p><p>C: <strong>SETCASE#&lt;caselist: string&gt;#&lt;will_cm: int&gt;#&lt;will_def: int&gt;#&lt;will_pro: int&gt;#&lt;will_judge: int&gt;#&lt;will_jury: int&gt;#&lt;will_steno: int&gt;#%</strong></p><p>Where the arguments are:</p><ul><li><code>caselist</code>: The list of cases this user is willing to host (assuming they are also willing to CM) (not used currently),</li><li><code>will_cm</code>: <code>1</code> if the user is willing to host cases (not used currently),</li><li><code>will_def</code>: <code>1</code> if the user is willing to defend a case / play as a defence attorney (or a co-defence attorney),</li><li><code>will_pro</code>: <code>1</code> if the user is willing to prosecute a case / play as a prosecutor (or a co-prosecutor),</li><li><code>will_judge</code>: <code>1</code> if the user is willing to judge a case,</li><li><code>will_jury</code>: <code>1</code> if the user is willing to be a member of the jury in a case,</li><li><code>will_steno</code>: <code>1</code> if the user is willing to be the stenographer of a case.</li></ul><p>It is up to the server to decide what to do with this packet. By default, tsuserver stores the information gathered from it, and uses it to decide whom to alert.</p><p>Additionally, this packet is sent everytime the &quot;Casing&quot; tickbox on the game area (not the &quot;Casing&quot; tickbox in the Settings!) is turned on or off. When it is turned off, a <code>SETCASE#&quot;&quot;#0#0#0#0#0#0#%</code> packet is sent (signalling that the user does not want to play as anything).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="case-alert">Case alert<a class="hash-link" href="#case-alert" title="Direct link to heading">â€‹</a></h2><p>This packet sends an alert to players about a case needing participants.</p><p>C: <strong>CASEA#&lt;casetitle: string&gt;#&lt;need_def: int&gt;#&lt;need_pro: int&gt;#&lt;need_judge: int&gt;#&lt;need_jury: int&gt;#&lt;need_steno: int&gt;#%</strong><br>
<!-- -->S: <strong>CASEA#&lt;message: string&gt;#&lt;need_def: int&gt;#&lt;need_pro: int&gt;#&lt;need_judge: int&gt;#&lt;need_jury: int&gt;#&lt;need_steno: int&gt;#%</strong></p><p>Where the arguments are:</p><ul><li><code>casetitle</code>: The title of the case being played,</li><li><code>message</code>: This could also equal to the title of the case, but the server may choose to decorate it -- for example, by default, tsuserver adds the &quot;X user needs this and that for Turnabout Y.&quot; text instead.</li><li><code>need_def</code>: <code>1</code> if the user needs a defence attorney,</li><li><code>need_pro</code>: <code>1</code> if the user needs a prosecutor,</li><li><code>need_judge</code>: <code>1</code> if the user needs a judge,</li><li><code>need_jury</code>: <code>1</code> if the user needs jurors,</li><li><code>need_steno</code>: <code>1</code> if the user need a stenographer.</li></ul><p>The above packet, when sent from clientside, requests the server to sent the serverside packet to all the targeted users.
The default behaviour is that users are targeted if they marked themselves as at least one of the roles the announcement is looking for using the <code>SETCASE</code> packet.
There is a default cooldown of a minute on a case alert.
If a <code>CASEA</code> packet arrives to the client, the client plays the given SFX at the <code>case_call</code> line in the current theme&#x27;s <code>courtroom_sounds.ini</code>, if one exists.</p><h1>Judge commands</h1><p>In-game, characters in the &quot;jud&quot; position have some special abilities.  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="witness-testimonycross-examination">Witness Testimony/Cross Examination<a class="hash-link" href="#witness-testimonycross-examination" title="Direct link to heading">â€‹</a></h2><p>These are animated gifs that display in the playing area that facilitate gameplay. They are often shortened to WTCE.  </p><p>C: <strong>RT#testimony1/testimony2/<!-- -->[judgeruling]<!-- -->#<!-- -->[&lt;variant: int&gt;]<!-- -->#%</strong> (testimony1 is WT, testimony2 is CE, judgeruling is Not Guilty / Guilty)<br>
<!-- -->S: (same)</p><p><code>judgeruling</code> and its <code>variant</code>s are a 2.6 addition.
The <code>variant</code> part only comes in when it concerns <code>judgeruling</code>.
Variant <code>0</code> is Not Guilty, variant <code>1</code> is Guilty.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="penalty-bars">Penalty bars<a class="hash-link" href="#penalty-bars" title="Direct link to heading">â€‹</a></h2><p>There are two penalty bars in the client, which are changed by this judge command.  </p><p>C: <strong>HP#1/2#0-10#%</strong> (1 is the defense bar, 2 is the prosecution bar)
S: (same)</p><h1>Backgrounds</h1><p>The client knows which background it should use based on this packet. Is often a part of the connection/loading process.</p><p>S: <strong>BN#&lt;background_name: string&gt;#%</strong></p><h1>Evidence</h1><p>The Attorney Online 2.4.0 client and later support the usage of evidence. It is worth noting that the evidence type has three attributes: name, description and image. The network usage is such;</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="add">Add<a class="hash-link" href="#add" title="Direct link to heading">â€‹</a></h2><p>C: <strong>PE#&lt;name: string&gt;#&lt;description: string&gt;#&lt;image: string&gt;#%</strong><br>
<!-- -->S: <strong>LE#&lt;name: string&gt;&amp;&lt;description: string&gt;&amp;&lt;image: string&gt;#...#%</strong> (the entire evidence list is sent here)   </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="remove">Remove<a class="hash-link" href="#remove" title="Direct link to heading">â€‹</a></h2><p>C: <strong>DE#&lt;id: int&gt;#%</strong><br>
<!-- -->S: <strong>LE#&lt;name: string&gt;&amp;&lt;description: string&gt;&amp;&lt;image: string&gt;#...#%</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="edit">Edit<a class="hash-link" href="#edit" title="Direct link to heading">â€‹</a></h2><p>C: <strong>EE#&lt;id: int&gt;#&lt;name: string&gt;#&lt;description: string&gt;#&lt;image: string&gt;#%</strong><br>
<!-- -->S: <strong>LE#&lt;name: string&gt;&amp;&lt;description: string&gt;&amp;&lt;image: string&gt;#...#%</strong></p><p>Take note that the LE header(i.e. the whole evidence list) is sent from the server every time the client does an operation. This is to ensure synchronization between clients. The server should also send its associated evidence list when the client joins a server or an area.</p><h1>Keep alive</h1><p>The client should have some indication as to when the server stops responding. That is where the CH packet comes in, which should be sent by the client at regular intervals, and receive an appropriate response from the server.  </p><p>C: <strong>CH#&lt;char_id: int&gt;#%</strong><br>
<!-- -->S: <strong>CHECK#%</strong></p><h1>Moderator commands</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="call-mod">Call mod<a class="hash-link" href="#call-mod" title="Direct link to heading">â€‹</a></h2><p>A command anyone can send, this alerts all mods on guard with a sound cue.  </p><p>C: <strong>ZZ#%</strong><br>
<!-- -->S: <strong>ZZ#&lt;call_mod_message: string&gt;#%</strong>  </p><p>The call mod message typically contains information such as which character called, which area called from and their IP. This depends on the serverside implementation, though.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ip-list">IP list<a class="hash-link" href="#ip-list" title="Direct link to heading">â€‹</a></h2><p>Moderators have a utility to list all the characters connected along with their IP addresses.<br>
<!-- -->OOC command: /ip  </p><p>Using this is optional. The server might opt to send a string formatted with newlines instead.  </p><p>S: <strong>IL#&lt;ip: string&gt;|&lt;char_name: string&gt;|&lt;char_id: int&gt;|...#%</strong> (extended to include all connected clients)  </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="muting">Muting<a class="hash-link" href="#muting" title="Direct link to heading">â€‹</a></h2><p>Prevents a client from sending IC messages. The server should enforce this serverside.<br>
<!-- -->OOC command: /mute &lt;char_name: string&gt;/&lt;char_id: int&gt;/-1(everyone)  </p><p>S: <strong>MU#&lt;char_id: int&gt;#%</strong> (mutes client with corresponding char_id)  </p><p>Unmuting is the same, except the header is UM instead of MU.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="kicking">Kicking<a class="hash-link" href="#kicking" title="Direct link to heading">â€‹</a></h2><p>Disconnects a client from the server.<br>
<!-- -->OOC command: /kick &lt;char_name: string&gt;/&lt;char_id: int&gt; <!-- -->[reason: string]</p><p>S: <strong>KK#&lt;char_id: int&gt;#&lt;reason: string&gt;#%</strong></p><p>In 2.6, a new <code>reason</code> field is added. Though it is not necessary in the calling of the OOC command (it is replaced with <code>N/A</code> if left empty), the packet requires one.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="banning">Banning<a class="hash-link" href="#banning" title="Direct link to heading">â€‹</a></h2><p>The ultimate penalty. Disconnects and prevents client from reconnecting.<br>
<!-- -->OOC command: /ban &lt;char_name: string&gt;/&lt;char_id: int&gt; <!-- -->[reason: string]</p><p>S: <strong>KB#&lt;char_id: int&gt;#&lt;reason: string&gt;#%</strong>  </p><p>In 2.6, a new <code>reason</code> field is added. Though it is not necessary in the calling of the OOC command (it is replaced with <code>N/A</code> if left empty), the packet requires one.</p><p>There is another packet associated with banning. The server should send this when a banned client attempts to connect;  </p><p>S: <strong>BD#&lt;reason: string&gt;#%</strong>  </p><p>This properly informs the client as to why a connection fails.</p><p>In 2.6.1, a new <code>reason</code> field is added. It is required when sending this packet.</p><h1>Master server</h1><p>C: <code>askforservers#%</code> (returns first server on the list starting from 0)<br>
<!-- -->S: first server<br>
<!-- -->C: <code>SR#[id]#%</code><br>
<!-- -->S: server of index <code>[id]</code>  </p><table><thead><tr><th>Function</th><th>Message</th><th>Direction</th></tr></thead><tbody><tr><td>Chat</td><td><code>CT#[username]#[message]#%</code></td><td>Server</td></tr><tr><td>Version check</td><td><code>VC#%</code></td><td>Server</td></tr><tr><td>Client version (AO2)</td><td><code>ID#[client software]#[version]#%</code></td><td>Server</td></tr><tr><td>Hard drive ID (or anything in practice)</td><td><code>HI#[hdid]#%</code></td><td>Server</td></tr><tr><td>Get all servers (AO2)</td><td><code>ALL#%</code></td><td>Server</td></tr><tr><td>Server entry (paginated) (AO1)</td><td><code>SN#[entry number]#[ip]#[server version]#[port]#[name]#[desc]#%</code></td><td>Client</td></tr><tr><td>Server entry (all) (AO2)</td><td><code>ALL#[[name]&amp;[desc]&amp;[ip]&amp;[port]#]%</code></td><td>Client</td></tr><tr><td>Server version</td><td><code>SV#[version]#%</code></td><td>Client</td></tr><tr><td>Ping</td><td><code>PING#%</code></td><td>Server</td></tr><tr><td>Server not advertised (reply to ping)</td><td><code>NOSERV#%</code></td><td>Advertiser</td></tr><tr><td>Heartbeat</td><td><code>SCC#[port]#[name]#[description]#[server software]#%</code></td><td>Server</td></tr><tr><td>Heartbeat success</td><td><code>PSDD#0#%</code></td><td>Advertiser</td></tr><tr><td>Keepalive</td><td><code>CHECK#%</code></td><td>Advertiser</td></tr><tr><td>Global ban</td><td><code>DOOM#%</code></td><td>Client</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/AttorneyOnline/AODocs/docs/Legacy/network_old.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/Legacy/loading_2.0"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">loading_2.0</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/Server/Server Rewrite"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">So you want to write a new server?</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#legend" class="table-of-contents__link toc-highlight">Legend</a></li><li><a href="#loading-10" class="table-of-contents__link toc-highlight">Loading 1.0</a></li><li><a href="#loading-20" class="table-of-contents__link toc-highlight">Loading 2.0</a></li><li><a href="#ic-messages" class="table-of-contents__link toc-highlight">IC messages</a></li><li><a href="#ooc-messages" class="table-of-contents__link toc-highlight">OOC messages</a></li><li><a href="#escape-codes" class="table-of-contents__link toc-highlight">Escape Codes</a></li><li><a href="#area-updates" class="table-of-contents__link toc-highlight">Area updates</a></li><li><a href="#case-preferences-update" class="table-of-contents__link toc-highlight">Case preferences update</a></li><li><a href="#case-alert" class="table-of-contents__link toc-highlight">Case alert</a></li><li><a href="#witness-testimonycross-examination" class="table-of-contents__link toc-highlight">Witness Testimony/Cross Examination</a></li><li><a href="#penalty-bars" class="table-of-contents__link toc-highlight">Penalty bars</a></li><li><a href="#add" class="table-of-contents__link toc-highlight">Add</a></li><li><a href="#remove" class="table-of-contents__link toc-highlight">Remove</a></li><li><a href="#edit" class="table-of-contents__link toc-highlight">Edit</a></li><li><a href="#call-mod" class="table-of-contents__link toc-highlight">Call mod</a></li><li><a href="#ip-list" class="table-of-contents__link toc-highlight">IP list</a></li><li><a href="#muting" class="table-of-contents__link toc-highlight">Muting</a></li><li><a href="#kicking" class="table-of-contents__link toc-highlight">Kicking</a></li><li><a href="#banning" class="table-of-contents__link toc-highlight">Banning</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"></div></footer></div>
<script src="/assets/js/runtime~main.531649e4.js"></script>
<script src="/assets/js/main.cb411173.js"></script>
</body>
</html>