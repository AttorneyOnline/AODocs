<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Development/Network">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Network | Attorney Online</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://attorneyonline.github.io/AODocs/Development/Network"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Network | Attorney Online"><meta data-rh="true" name="description" content="Network Protocol"><meta data-rh="true" property="og:description" content="Network Protocol"><link data-rh="true" rel="icon" href="/AODocs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://attorneyonline.github.io/AODocs/Development/Network"><link data-rh="true" rel="alternate" href="https://attorneyonline.github.io/AODocs/Development/Network" hreflang="en"><link data-rh="true" rel="alternate" href="https://attorneyonline.github.io/AODocs/Development/Network" hreflang="x-default"><link rel="stylesheet" href="/AODocs/assets/css/styles.60e5673a.css">
<link rel="preload" href="/AODocs/assets/js/runtime~main.a5d2275f.js" as="script">
<link rel="preload" href="/AODocs/assets/js/main.345a0c90.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/AODocs/"><div class="navbar__logo"><img src="/AODocs/img/favicon.ico" alt="Attorney Online Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/AODocs/img/favicon.ico" alt="Attorney Online Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Attorney Online</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/AODocs/Authoring/">Authoring</a><button aria-label="Toggle the collapsible sidebar category &#x27;Authoring&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/AODocs/Development/Network">Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/AODocs/Development/Network">Network</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/AODocs/Development/Roadmap">Roadmap</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/AODocs/Gameplay/Casing">Gameplay</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/AODocs/Legacy/loading_1.0">Legacy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/AODocs/Server/Server Rewrite">Server</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/AODocs/">Documentation</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/AODocs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Development</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Network</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Network</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="network-protocol">Network Protocol<a class="hash-link" href="#network-protocol" title="Direct link to heading">â€‹</a></h2><p>Attorney Online&#x27;s network protocol is one with a rich and colorful past. It has mostly remained intact since AO1 due to a constant demand for backward compatibility; even to this day, AO1 clients are still able to find servers from the lobby and join a game.</p><ul><li><a href="#network-protocol">Network Protocol</a><ul><li><a href="#handshake">Handshake</a><ul><li><a href="#hard-drive-id">Hard drive ID</a></li><li><a href="#client-version-information">Client version information</a></li><li><a href="#feature-list">Feature list</a></li><li><a href="#asset-link">Asset Link</a></li><li><a href="#player-count">Player count</a></li><li><a href="#resource-counts">Resource counts</a></li><li><a href="#character-list">Character list</a></li><li><a href="#evidence-list">Evidence list</a></li><li><a href="#music-list">Music list</a></li><li><a href="#final-confirmation">Final confirmation</a></li></ul></li><li><a href="#character-selection">Character selection</a><ul><li><a href="#taken-characters">Taken characters</a></li><li><a href="#choose-character">Choose character</a></li></ul></li><li><a href="#in-character-commands">In-character commands</a><ul><li><a href="#in-character-message">In-character message</a></li><li><a href="#background">Background</a></li><li><a href="#music">Music</a></li><li><a href="#penalty-health-bars">Penalty (health) bars</a></li><li><a href="#witness-testimonycross-examination-wtce">Witness Testimony/Cross Examination (WT/CE)</a></li><li><a href="#set-position">Set position</a></li><li><a href="#available-positions">Available positions</a></li></ul></li><li><a href="#out-of-character-message">Out-of-character message</a></li><li><a href="#evidence">Evidence</a><ul><li><a href="#add">Add</a></li><li><a href="#remove">Remove</a></li><li><a href="#edit">Edit</a></li></ul></li><li><a href="#areas">Areas</a><ul><li><a href="#switch-area">Switch area</a></li><li><a href="#area-updates">Area updates</a></li><li><a href="#music-list-1">Music list</a></li><li><a href="#area-list">Area list</a></li></ul></li><li><a href="#casing">Casing</a><ul><li><a href="#case-preferences-update">Case preferences update</a></li><li><a href="#case-alert">Case alert</a></li></ul></li><li><a href="#moderator-commands">Moderator commands</a><ul><li><a href="#authenticate">Authentication</a></li><li><a href="#call-mod">Call mod</a></li><li><a href="#kick">Kick</a></li><li><a href="#ban">Ban</a></li><li><a href="#popup">Popup</a></li></ul></li><li><a href="#keep-alive">Keep alive</a></li><li><a href="#subtheme-switching">Subtheme switching</a></li><li><a href="#timers">Timers</a></li><li><a href="#judge-controls">Judge controls</a></li><li><a href="#escape-codes">Escape codes</a></li><li><a href="#obsolete">Obsolete</a><ul><li><a href="#fantacrypt">FantaCrypt</a></li><li><a href="#slow-loading">Slow loading</a></li><li><a href="#mod-password">Mod password</a></li><li><a href="#ip-list">IP list</a></li><li><a href="#mute">Mute</a></li><li><a href="#evidence-list">Evidence list</a></li></ul></li></ul></li><li><a href="#master-server-protocol">Master server protocol</a><ul><li><a href="#paginated-list-obsolete">Paginated list (obsolete)</a></li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="handshake">Handshake<a class="hash-link" href="#handshake" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hard-drive-id">Hard drive ID<a class="hash-link" href="#hard-drive-id" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>HI#{hdid}#%</code></p><p>Sends the client&#x27;s hard drive ID (supposedly a unique identifier) to the server for ban tracking. This increases the work needed to evade a ban, as it is not as simple as using a VPN.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="version-information">Version information<a class="hash-link" href="#version-information" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>ID#{player number}#{version}#%</code>
<strong>Client:</strong> <code>ID#{client}#{version}#%</code></p><p>Sends the player number (not used) and the server version to the client. The client replies with its name and version.</p><p><strong>Response:</strong> Player count, feature list</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="player-count">Player count<a class="hash-link" href="#player-count" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>PN#{players}#{max}#%</code><br>
<strong>Server:</strong> <code>PN#{players}#{max}#{server_description}#%</code> (since 2.10)</p><p>Specifies the number of players in the server and the player limit. The player limit is not enforced in the client, and often not in the server either.<br>
Since 2.10 the server description is appended to the packet to support server descriptions in the favourite tab.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="feature-list">Feature list<a class="hash-link" href="#feature-list" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>FL#{feature1}#{feature2}#...#%</code></p><p>Lists the features supported by the server, essentially acting as a list of feature flags.</p><p>(The FL packet was introduced in 2.3.3; prior to 2.3.3, features depended on detecting a compatible server version.)</p><p>Features introduced in 2.1.0 (the first AO2 release):</p><ul><li><code>yellowtext</code>: Enables the use of yellow text.</li><li><code>flipping</code>: Enables the use of emote flipping.</li><li><code>customobjections</code>: Enables the use of a single custom objection named <code>custom</code>.</li><li><code>fastloading</code>: Enables the use of &quot;fast loading&quot; instead of the legacy loading protocol.</li><li><code>noencryption</code>: Disables FantaCrypt for the remainder of the session.</li></ul><p>Introduced in 2.3 - 2.5:</p><ul><li><code>deskmod</code>: Allows forcing desk/no desk. Introduced in 2.3.2.</li><li><code>evidence</code>: Enables evidence. Introduced in 2.4.0.</li></ul><p>Introduced in 2.6:</p><ul><li><code>cccc_ic_support</code>: Enables 2.6 extensions for the in-character command.</li><li><code>arup</code>: Indicates that the server broadcasts area updates.</li><li><code>casing_alerts</code>: Enables casing alerts.</li><li><code>modcall_reason</code>: Enables calling moderators with a custom reason.</li></ul><p>Introduced in 2.8:</p><ul><li><code>looping_sfx</code>: Enables looping SFX extensions for the in-character command.</li><li><code>additive</code>: Enables additive text.</li><li><code>effects</code>: Enables effect overlays.</li></ul><p>Introduced in 2.9:</p><ul><li><code>y_offset</code>: Enables vertical offset support.</li><li><code>expanded_desk_mods</code>: Enables desk modifiers 2 through 5.</li></ul><p>Introduced in 2.9.1:</p><ul><li><code>auth_packet</code>: Enables the use of the <code>AUTH</code> packet.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="asset-link">Asset link<a class="hash-link" href="#asset-link" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>ASS#{asset_link}#%</code></p><p>Specifies the asset link of the server. It allows server to set a custom content repository, which is used for WebAO or client music streaming.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="resource-counts">Resource counts<a class="hash-link" href="#resource-counts" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>askchaa#%</code><br>
<strong>Server:</strong> <code>SI#{char_cnt}#{evi_cnt}#{music_cnt}#%</code></p><p>Requests character, evidence, and track counts ahead of time for memory allocation.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="character-list">Character list<a class="hash-link" href="#character-list" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>RC#%</code><br>
<strong>Server:</strong> <code>SC#{char_name}&amp;{char_desc}#...#%</code></p><p>Requests a full list of characters. Note that <code>char_desc</code> is obsolete and likely not present.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="evidence-list">Evidence list<a class="hash-link" href="#evidence-list" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>LE#{name}&amp;{description}&amp;{image}#...#%</code></p><p>See the <a href="#list">evidence list</a> packet.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="music-list">Music list<a class="hash-link" href="#music-list" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>RM#%</code><br>
<strong>Server:</strong> <code>SM#{music_name}#...#%</code></p><p>Requests a full list of music tracks.</p><p>Note that areas are also considered tracks. Typically, tracks are also contained in categories, which are prefixed with multiple equals signs (<code>==</code>).</p><p>Music tracks must contain file extensions.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="final-confirmation">Final confirmation<a class="hash-link" href="#final-confirmation" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>RD#%</code><br>
<strong>Server:</strong> <code>DONE#%</code></p><p>The client confirms that it has joined the server and is ready to join the default room. Typically, before <code>DONE</code> is sent, the list of taken characters is also sent, among other information such as the message of the day (displayed in OOC chat).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="character-selection">Character selection<a class="hash-link" href="#character-selection" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="taken-characters">Taken characters<a class="hash-link" href="#taken-characters" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>CharsCheck#{taken}#...#%</code></p><p>The server sends an array of numbers representing whether or not each character of that index is taken or not.</p><p><code>taken</code> may be one of the following:</p><ul><li><code>-1</code>: character is taken</li><li><code> 0</code>: character is free</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="choose-character">Choose character<a class="hash-link" href="#choose-character" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>CC#0#{char_id}#{hdid}#%</code><br>
<strong>Server:</strong> <code>PV#{player_id}#CID#{char_id}#%</code></p><p>The client selects a character to use in the room. Note that <code>hdid</code> is an obsolete parameter. (The first parameter was once a player ID, but player IDs are also obsolete.)</p><p>If the character cannot be used, the server will not respond. Otherwise, the server responds with the character selected.</p><blockquote><p><strong>Note:</strong> A <code>PV</code> response may be sent at any time to force a character switch, and the character ID may not necessarily be the one requested by the player.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="in-character-commands">In-character commands<a class="hash-link" href="#in-character-commands" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="in-character-message">In-character message<a class="hash-link" href="#in-character-message" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong></p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MS#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{desk_mod}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{preanim}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{character}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{emote}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{message}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{side}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sfx-name}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{emote_modifier}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{char_id}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sfx-delay}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{shout_modifier}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{evidence}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{flip}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{realization}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{text_color}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{showname}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{other_charid}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{self_offset}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{noninterrupting_preanim}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sfx_looping}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{screenshake}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{frames_shake}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{frames_realization}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{frames_sfx}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{additive}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{effect}#%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Server</strong>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">MS#  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{desk_mod}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{preanim}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{character}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{emote}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{message}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{side}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sfx-name}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{emote_modifier}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{char_id}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sfx-delay}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{shout_modifier}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{evidence}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{flip}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{realization}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{text_color}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{showname}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{other_charid}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{other_name}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{other_emote}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{self_offset}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{other_offset}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{other_flip}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{noninterrupting_preanim}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{sfx_looping}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{screenshake}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{frames_shake}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{frames_realization}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{frames_sfx}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{additive}#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{effect}#%</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>An in-character (IC) message is a basic form of viewport event in which a animation is displayed on the screen with various parameters. Line breaks are included for cleanliness and are not present in the actual packet.</p><blockquote><p>Note that the only difference between the client and server messages is that the client does not have the <code>other_name</code> or <code>other_emote</code> fields.</p></blockquote><p>Reference of fields:</p><ul><li><p><strong>desk_mod</strong>: Whether or not to override desk appearance.</p><ul><li><code>chat</code>: Positions &quot;def&quot;, &quot;pro&quot;, and &quot;wit&quot; default to desk and the positions &quot;hld&quot;, &quot;hlp&quot; and &quot;jud&quot; to no desk.</li><li><code>0</code>: desk is hidden</li><li><code>1</code>: desk is shown</li><li><code>2</code>: desk is hidden during preanim, shown when it ends</li><li><code>3</code>: desk is shown during preanim, hidden when it ends</li><li><code>4</code>: desk is hidden during preanim, character is centered and pairing is ignored, when it ends desk is shown and pairing is restored</li><li><code>5</code>: desk is shown during preanim, when it ends character is centered and pairing is ignored</li></ul></li><li><p><strong>preanim</strong>: The animation that plays before the character starts talking. Does not include file extension.</p></li><li><p><strong>character</strong>: The folder name of the character that is talking.</p></li><li><p><strong>emote</strong>: The emote that should play. Does not include <code>(a)</code>/<code>(b)</code> prefixes or file extensions.</p></li><li><p><strong>message</strong>: The chat message as to be displayed in the chatbox and the IC log. Note that the message may contain markup that must be parsed.</p></li><li><p><strong>side</strong>: Which side the character is on. See the character authoring page for valid positions.</p></li><li><p><strong>sfx_name</strong>: Name of the sound effect that should play during the preanimation (if the preanimation is enabled).</p></li><li><p><strong>emote_modifier</strong>: A number that dictates emote behavior:</p><ul><li><code>0</code>: do not play preanimation; overridden to 2 by a non-<code>0</code> objection modifier</li><li><code>1</code>: play preanimation (and sfx)</li><li><code>2</code>: play preanimation and play objection</li><li><code>3</code>: <em>unused</em></li><li><code>4</code>: <em>unused</em></li><li><code>5</code>: no preanimation and zoom</li><li><code>6</code>: objection and zoom, no preanim</li></ul></li><li><p><strong>char_id</strong>: Character identifier; dictates the index of the character in the character list (starting from zero).</p></li><li><p><strong>sfx_delay</strong>: Dictates how long in milliseconds the client should wait after the preanimation has started playing before playing the associated sound effect.</p></li><li><p><strong>objection_modifier</strong>: Dictates if the player uses a shout.</p><ul><li><code>0</code>: nothing</li><li><code>1</code>: &quot;Hold it!&quot;</li><li><code>2</code>: &quot;Objection!&quot;</li><li><code>3</code>: &quot;Take that!&quot;</li><li><code>4&amp;{name}</code>: custom shout (since 2.8)</li></ul></li><li><p><strong>evidence</strong>: ID of the evidence presented. 0 is no evidence presented, so evidence ID effectively starts from 1.</p></li><li><p><strong>flip</strong>: Dictates if the emote should be flipped.</p><ul><li><code>0</code>: no flip</li><li><code>1</code>: flip</li></ul></li><li><p><strong>realization</strong>: Dictates whether a realization flash and sound effect should play or not.</p><ul><li><code>0</code>: no realization</li><li><code>1</code>: realization</li></ul></li><li><p><strong>text_color</strong>: Dictates which color the text of the chat message should be.</p><ul><li><code>0</code>: white</li><li><code>1</code>: green</li><li><code>2</code>: red</li><li><code>3</code>: orange</li><li><code>4</code>: blue (disables talking animation)</li><li><code>5</code>: yellow</li><li><code>6</code>: rainbow (removed in 2.8)</li></ul></li><li><p><strong>showname</strong>: If used, this will show a custom name (showname) for the character.</p></li><li><p><strong>other_charid</strong>: The character ID of the person the player wishes to pair up with.</p></li><li><p><strong>other_name</strong>: The folder name of the character the player is pairing up with (in case of INI swapping).</p></li><li><p><strong>other_emote</strong>: The emote the user&#x27;s pair was doing. Note that by default, zooms (that are correctly defined as such) do not update this value, so a pair of zooms will not appear. Zooms also enjoy special privileges, in that (assuming they are correctly defined, again) they make the pair disappear in the client and get centered.</p></li><li><p><strong>self_offset</strong>: the percentage by which the character is shifted horizontally, from <code>-100</code> (one whole screen&#x27;s worth to the left) to <code>100</code> (one whole screen&#x27;s worth to the right). This parameter also stores vertical offset, which is self-explanatory.</p><ul><li><code>{x_offset}</code>: &lt;2.9</li><li><code>{x_offset}&amp;{y_offset}</code>: 2.9+</li></ul></li><li><p><strong>other_offset</strong>: The user&#x27;s pair&#x27;s <code>self_offset</code>, basically.</p></li><li><p><strong>other_flip</strong>: The user&#x27;s pair&#x27;s <code>char_id2/flip</code>, basically.</p></li><li><p><strong>noninterrupting_preanim</strong>: If <code>1</code>, the text begins at the same time as the preanimation.</p></li><li><p><strong>sfx_looping</strong>: If <code>1</code>, the sound effect loops until another emote is played.</p></li><li><p><strong>screenshake</strong>: If <code>1</code>, the screen shakes (TODO: on preanimation or on chat?).</p></li><li><p><strong>frames_shake</strong>: A list of frames for which the screen should shake (TODO: list format).</p></li><li><p><strong>frames_realization</strong>: A list of frames for which the screen should flash (TODO: list format).</p></li><li><p><strong>frames_sfx</strong>: A list of frames for which the sound effect should play.</p></li><li><p><strong>additive</strong>: If <code>1</code>, does not clear the chatbox&#x27;s previous message.</p></li><li><p><strong>effect</strong>: The overlay effect to be displayed.</p></li></ul><p>All sections from <code>showname</code> onwards is 2.6+. <code>sfx_looping</code> onwards is 2.8+.</p><blockquote><p>Note that servers may modify specific values of this message. For example, disemvoweling and shaking modify your text, and <code>/force_nonint_pres</code> forces your preanims to be noninterrupting. Therefore, to determine if your message was successfully sent, the character ID should be compared instead of the message text or the entire packet.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="background">Background<a class="hash-link" href="#background" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>BN#{background}%</code><br>
<strong>Server:</strong> <code>BN#{background}#{position}%</code> (since 2.8)</p><p>Sets the background of the viewport, and optionally the position.</p><p>Clients can set the background with a server chat command, such as <code>/bg</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="music">Music<a class="hash-link" href="#music" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>MC#{songname}#{char_id}#{showname}#{effects}#%</code><br>
<strong>Server:</strong> <code>MC#{songname}#{char_id}#{showname}#{looping}#{channel}#{effects}#%</code></p><p>Plays the specified track (with file extension) and records the event to the IC log.</p><p>Since 2.6, a <code>showname</code> piece is added at the end. This is for the chatlog to be able to correctly store and show who changed the music, so that it does not end up confusing players with the character&#x27;s name instead of the showname.</p><p>Since 2.8, the track is expected to loop clientside. Before 2.8, the track was not expected to loop, and thus servers had to add a looping feature where the <code>MC</code> packet is sent to replay the track.</p><ul><li><strong>looping</strong>: if greater than zero, indicates client-side looping</li><li><strong>channel</strong>: channel number to play on (0-3)<ul><li>Typically, channel 0 is used as the main BGM channel, whereas channel 1 is used for area-specific soundscapes.</li></ul></li><li><strong>effects</strong>: a bit field of transition effects:<ul><li>Bit 0: fade in</li><li>Bit 1: fade out</li><li>Bit 2: sync position</li></ul></li></ul><p>The canonical &quot;empty track&quot; is <code>~stop.mp3</code>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="penalty-health-bars">Penalty (health) bars<a class="hash-link" href="#penalty-health-bars" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>HP#{bar}#{value}#%</code><br>
<strong>Server:</strong> same</p><p>Updates the penalty bar. This is typically only allowed when the player is in the judge (<code>jud</code>) position.</p><ul><li><strong>bar</strong>: the bar to be updated<ul><li><code>1</code>: defense bar (red bar)</li><li><code>2</code>: prosecution bar (blue bar)</li></ul></li><li><strong>value</strong>: the value to set the bar to (0-10)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="witness-testimonycross-examination-wtce">Witness Testimony/Cross Examination (WT/CE)<a class="hash-link" href="#witness-testimonycross-examination-wtce" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>RT#{animation}#%</code><br>
<strong>Server:</strong> same</p><p>Overlays a non-looping special animation. This is typically only allowed when the player is in the judge (<code>jud</code>) position.</p><p><strong>animation</strong> may be one of the following:</p><ul><li><code>testimony1</code> - &quot;Witness Testimony&quot;</li><li><code>testimony2</code> - &quot;Cross Examination&quot;</li><li><code>judgeruling#0</code> - &quot;Not Guilty&quot; (since 2.6)</li><li><code>judgeruling#1</code> - &quot;Guilty&quot; (since 2.6)</li><li><code>testimony1#1</code> - Hides the &quot;Testimony&quot; indicator (since 2.9)</li><li>Anything else - Custom splash. SFX name and animation filename are exactly the string provided (since 2.9)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="set-position">Set position<a class="hash-link" href="#set-position" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>SP#{side}#%</code></p><p>Sets the position dropdown on the client to <code>side</code>. Added in 2.8.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="available-positions">Available positions<a class="hash-link" href="#available-positions" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>SD#{side1}*{side2}*...#%</code></p><p>Overrides the position dropdown on the client to the specified list of positions. Added in 2.8.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="out-of-character-message">Out-of-character message<a class="hash-link" href="#out-of-character-message" title="Direct link to heading">â€‹</a></h3><p><strong>Client:</strong> <code>CT#{name}#{message}#%</code><br>
<strong>Server:</strong> <code>CT#{name}#{message}#{is_from_server}#%</code></p><p>Represents a simple message with name and text. OOC is used to convey information without interrupting ongoing gameplay.</p><p><code>is_from_server</code> is an addition that arrived with 2.6. If <code>1</code>, the name is colored with the theme&#x27;s designated OOC server color.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="evidence">Evidence<a class="hash-link" href="#evidence" title="Direct link to heading">â€‹</a></h3><p>Supported by 2.4 onward. Every evidence item has three attributes: name, description and image.</p><blockquote><p>Note that the whole evidence list is broadcasted every time the client performs any evidence operation, to ensure synchronization between clients. The server also sends the evidence list when the client joins an area.</p></blockquote><h4 class="anchor anchorWithStickyNavbar_LWe7" id="list">List<a class="hash-link" href="#list" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>LE#{name}&amp;{description}&amp;{image}#...#%</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="add">Add<a class="hash-link" href="#add" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>PE#{name}#{description}#{image}#%</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="remove">Remove<a class="hash-link" href="#remove" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>DE#{id}#%</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="edit">Edit<a class="hash-link" href="#edit" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>EE#{id}#{name}#{description}#{image}#%</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="areas">Areas<a class="hash-link" href="#areas" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="switch-area">Switch area<a class="hash-link" href="#switch-area" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>MC#{area_name}#{char_id}#%</code></p><p>Switches to a different area/room. As areas are more or less a hack built into the music list, the <code>MC</code> packet is reused for this purpose.</p><p>The server will typically reset the health bars, background, and evidence.</p><p>If the specified area does not exist, the packet is ignored.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="area-updates">Area updates<a class="hash-link" href="#area-updates" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong></p><ul><li><code>ARUP#0#{area1_players}#{area2_players}#...#%</code></li><li><code>ARUP#1##{area1_status}##{area2_status}##...#%</code></li><li><code>ARUP#2##{area1_cm}##{area2_cm}##...#%</code></li><li><code>ARUP#3##{area1_locked}##{area2_locked}##...#%</code></li></ul><p>Indicates additional information about all areas.</p><p>The first argument indicates the information being sent about every area:</p><ul><li><code>0</code>: player counts</li><li><code>1</code>: area statuses<ul><li>Recognized statuses: <code>IDLE</code>, <code>LOOKING-FOR-PLAYERS</code>, <code>CASING</code>, <code>RECESS</code>, <code>RP</code>, <code>GAMING</code></li></ul></li><li><code>2</code>: case managers (CMs)<ul><li>This should be set to <code>FREE</code> if there are no case managers in the area. </li></ul></li><li><code>3</code>: locked states (string, not boolean)<ul><li>Recognized lock states: <code>FREE</code>, <code>SPECTATABLE</code>, <code>LOCKED</code> </li></ul></li></ul><p>This packet has as many pieces (plus one) as there are areas on the server. It describes, in order, every area&#x27;s given property.</p><p>For instance, a packet of <code>ARUP#0#4#3#7#2#0#0#%</code> would mean that:</p><ul><li>There are 4 players in the first area (or, technically, in the zeroth area)</li><li>There are 3 in the second,</li><li>There are 7 in the third,</li><li>There are 2 in the fourth,</li><li>And 0 in the last two.</li></ul><p>This packet was added in 2.6.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="music-list-1">Music list<a class="hash-link" href="#music-list-1" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>FM#{track1}#{track2}#...#%</code></p><p>Like the standard music list packet, but excludes areas.</p><p>This can be used to update the music list on a per-area basis.</p><p>This packet was added in 2.8.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="area-list">Area list<a class="hash-link" href="#area-list" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>FM#{area1}#{area2}#...#%</code></p><p>Like the standard music list packet, but excludes music and only lists areas.</p><p>This can be used to add and remove areas dynamically.</p><p>This packet was added in 2.8.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="casing">Casing<a class="hash-link" href="#casing" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="case-preferences-update">Case preferences update<a class="hash-link" href="#case-preferences-update" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>SETCASE#{caselist}#{cm}#{def}#{pro}#{judge}#{jury}#{steno}#%</code></p><p>Updates the user&#x27;s casing alert preferences.</p><p>Parameters:</p><ul><li><strong>caselist</strong>: the list of cases this user is willing to host (assuming they are also willing to CM) (not used)</li><li><strong>cm</strong>: <code>1</code> if the user is willing to host cases (not used)</li><li><strong>def</strong>: <code>1</code> if the user is willing to defend a case / play as a defense attorney (or a co-defense attorney)</li><li><strong>pro</strong>: <code>1</code> if the user is willing to prosecute a case / play as a prosecutor (or a co-prosecutor)</li><li><strong>judge</strong>: <code>1</code> if the user is willing to judge a case</li><li><strong>jury</strong>: <code>1</code> if the user is willing to be a member of the jury in a case</li><li><strong>steno</strong>: <code>1</code> if the user is willing to be the stenographer of a case</li></ul><p>It is up to the server to decide what to do with this packet. By default, tsuserver does nothing with this information (though it is stored, for some reason) and sends all case alerts to every connected client.</p><p>Additionally, this packet is sent everytime the &quot;Casing&quot; tickbox on the game area is toggled. When it is turned off, a <code>SETCASE#&quot;&quot;#0#0#0#0#0#0#%</code> packet is sent (indicating that the user is not interested in casing).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="case-alert">Case alert<a class="hash-link" href="#case-alert" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>CASEA#{case_title}#{need_def}#{need_pro}#{need_judge}#{need_jury}#{need_steno}#%</code><br>
<strong>Server:</strong> same, except <code>{message}</code> instead of <code>{case_title}</code></p><p>Sends an alert to players about a case needing participants.</p><p>Where the arguments are:</p><ul><li><strong>case_title</strong>: the title of the case being played</li><li><strong>message</strong>: the title of the case, but may be modified by the server -- for example, by default, tsuserver adds the &quot;X user needs this and that for Turnabout Y.&quot; text instead.</li><li><strong>need_def</strong>: <code>1</code> if the user needs a defense attorney,</li><li><strong>need_pro</strong>: <code>1</code> if the user needs a prosecutor,</li><li><strong>need_judge</strong>: <code>1</code> if the user needs a judge,</li><li><strong>need_jury</strong>: <code>1</code> if the user needs jurors,</li><li><strong>need_steno</strong>: <code>1</code> if the user need a stenographer.</li></ul><p>The above packet, when sent from clientside, requests the server to sent the serverside packet to all relevant users.</p><p>Users are targeted if:</p><ul><li>they marked themselves as at least one of the roles the announcement is looking for (using the <code>SETCASE</code> packet). (<a href="https://github.com/AttorneyOnline/akashi" target="_blank" rel="noopener noreferrer">akashi</a>)</li><li>they are currently connected to the server, regardless of casing preferences (<a href="https://github.com/AttorneyOnline/tsuserver3" target="_blank" rel="noopener noreferrer">tsuserver3</a>)</li></ul><p>This packet may be rate-limited.</p><h4></h4><h3 class="anchor anchorWithStickyNavbar_LWe7" id="moderator-commands">Moderator commands<a class="hash-link" href="#moderator-commands" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="authenticate">Authenticate<a class="hash-link" href="#authenticate" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>AUTH#{state: int}#%</code></p><p><strong>Parameters:</strong>
<strong>state:</strong></p><ul><li><code>1</code> or higher: Successful log-in. Displays the guard button.</li><li><code>0</code>: Unsuccessful log-in attempt.</li><li><code>-1</code> or lower: Log-out. Hides the guard button.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="call-mod">Call mod<a class="hash-link" href="#call-mod" title="Direct link to heading">â€‹</a></h4><p><strong>Client:</strong> <code>ZZ#{reason}#%</code><br>
<strong>Server:</strong> <code>ZZ#{message}#%</code><br></p><p>Alerts all mods on guard with a sound cue.</p><p>The call mod message typically contains information such as which character called, which area they called from, and a user-specified message.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="kick">Kick<a class="hash-link" href="#kick" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>KK#{reason}#%</code></p><p>Notifies a client that they were kicked.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ban">Ban<a class="hash-link" href="#ban" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>KB#{reason}#%</code></p><p>Notifies a client that they were kicked and banned.</p><p><strong>Server:</strong> <code>BD#{reason}#%</code></p><p>Notifies a client that they cannot join because they are banned.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="popup">Popup<a class="hash-link" href="#popup" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>BB#{message}</code></p><p>Notifies a client with a popup containing the specified <strong>message</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="keep-alive">Keep alive<a class="hash-link" href="#keep-alive" title="Direct link to heading">â€‹</a></h3><p><strong>Client:</strong> <code>CH#&lt;char_id: int&gt;#%</code><br>
<strong>Server:</strong> <code>CHECK#%</code></p><p>Sent to ensure that the server and client are still alive. Some servers expect the client to send this packet as often as 10 seconds.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subtheme-switching">Subtheme switching<a class="hash-link" href="#subtheme-switching" title="Direct link to heading">â€‹</a></h3><p><strong>Server:</strong> <code>ST#{subtheme}#{reload}#%</code></p><p>Instructs the client to switch to a given subtheme. The client can ignore this if the user&#x27;s subtheme is manually set.</p><p><strong>Parameters:</strong></p><ul><li><strong>subtheme:</strong> The subtheme to switch to.</li><li><strong>reload:</strong> If <code>1</code>, the client will reload theme.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="timers">Timers<a class="hash-link" href="#timers" title="Direct link to heading">â€‹</a></h3><p><strong>Server:</strong> <code>TI#{timer_id: int}#{command: int}#{time: int}#%</code></p><p>Instructs the client to manipulate the timers on its UI.</p><p><strong>Parameters:</strong></p><ul><li><strong>timer_id:</strong> The ID of the timer to manipulate, <code>0</code>-<code>4</code>. Typically, <code>0</code> is used as a &quot;global&quot; timer (be it server-wide or per-&quot;hub&quot;)</li><li><strong>command:</strong><ul><li><code>0</code>: Start/resume/sync timer at <code>time</code></li><li><code>1</code>: Pause timer at <code>time</code></li><li><code>2</code>: Show timer</li><li><code>3</code>: Hide timer</li></ul></li><li><strong>time:</strong> The time to display on the timer, in milliseconds.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="judge-controls">Judge controls<a class="hash-link" href="#judge-controls" title="Direct link to heading">â€‹</a></h3><p><strong>Server:</strong> <code>JD#{state: int}#%</code></p><p>Instructs the client to show or hide the judge controls.</p><p><strong>Parameters:</strong></p><ul><li><strong>state:</strong><ul><li><code>-1</code>: Show or hide the judge controls, depending on the client&#x27;s position.</li><li><code>0</code>: Hide the judge controls.</li><li><code>1</code>: Show the judge controls.</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="escape-codes">Escape codes<a class="hash-link" href="#escape-codes" title="Direct link to heading">â€‹</a></h3><p>Escape codes allows characters like &#x27;#&#x27; to be sent in messages.</p><ul><li><code>%</code>: <code>&lt;percent&gt;</code></li><li><code>#</code>: <code>&lt;num&gt;</code></li><li><code>$</code>: <code>&lt;dollar&gt;</code></li><li><code>&amp;</code>: <code>&lt;and&gt;</code></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="obsolete">Obsolete<a class="hash-link" href="#obsolete" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="fantacrypt">FantaCrypt<a class="hash-link" href="#fantacrypt" title="Direct link to heading">â€‹</a></h4><p>AO1 encrypted the headers of the packets sent by the client to the server.</p><ul><li>FantaCrypt seeds a PRNG with a known value (the decryption key), where the lower two bytes are used in the PRNG, and the upper byte of those two bytes is used in the cipher.</li><li>The current key is XOR&#x27;ed with the current byte.</li><li>To get the key value for the next byte, the byte and key are added together.</li><li>Then, some multiplication and addition is done to that value. (This PRNG behavior is similar to a <a href="https://en.wikipedia.org/wiki/Linear_congruential_generator" target="_blank" rel="noopener noreferrer">linear congruential generator</a>.)</li><li>Finally, everything but the lower two bytes are discarded.</li></ul><p>However, there was a major flaw in the implementation of FantaCrypt: the server supplies the client with the initial key to use for every packet. Thus, it is totally vulnerable to a replay attack.</p><p>Many clients do not actually even implement the FantaCrypt algorithm, but instead use a hardcoded key of 5, which is sent as 0x34 in the &#x27;decryptor&#x27; packet. This is because the &#x27;decryptor&#x27; packet argument is the key to be used, but encrypted. The decryptor value is always encrypted with a magic number key value: 322 decimal. Moreover, FantaCrypt is only used in messages sent by the client to the server and not vice versa.</p><p>The encryption algorithm was plagiarized from a <a href="https://stackoverflow.com/questions/6798188/delphi-simple-string-encryption" target="_blank" rel="noopener noreferrer">Stack Overflow answer</a>.</p><p>The protocol for FantaCrypt is as follows:</p><p><strong>Server:</strong> <code>decryptor#{key}#%</code>
<strong>Client:</strong> <code>&lt;encrypted traffic&gt;</code></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="slow-loading">Slow loading<a class="hash-link" href="#slow-loading" title="Direct link to heading">â€‹</a></h4><p>Before &quot;fast loading&quot; character and music requests were developed, a slower, paginated set of requests was used:</p><table><thead><tr><th>Message</th><th>Description</th><th>Typical response</th></tr></thead><tbody><tr><td><code>askchar2#%</code></td><td>Get first page of characters</td><td><code>CI#0#...#%</code></td></tr><tr><td><code>AN#{n}#%</code></td><td>Get page <code>n</code> of characters</td><td><code>CI#{n}#...#%</code>, or <code>EI#1#...#%</code> if nonexistent page</td></tr><tr><td><code>AE#{n}#%</code></td><td>Get <code>n</code>th evidence</td><td><code>EI#{n}#...#%</code>, or <code>EM#0#...#%</code> if nonexistent page</td></tr><tr><td><code>EM#{n}#%</code></td><td>Get page <code>n</code> of tracks</td><td><code>EM#{n}#...#%</code>, or <code>CharsCheck#...#%</code> and remainder of handshake</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mod-password">Mod password<a class="hash-link" href="#mod-password" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>OPPASS#{modpass in hex}#%</code></p><p>Previously, servers would send the mod password in hex encoding to the clients; the reason for this was to allow a clientside login check to show the moderator UI. It is entirely unknown how it was considered logical to send the mod password in plain text to all clients.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="ip-list">IP list<a class="hash-link" href="#ip-list" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>IL#{ip}|{char_name}|{char_id}#...#%</code></p><p>Sends a list of all players. This is an infrequently used command and is typically sent as a response to <code>/ip</code> (an obsolete command).</p><p>The server might opt to send an OOC message instead.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mute">Mute<a class="hash-link" href="#mute" title="Direct link to heading">â€‹</a></h4><p><strong>Server:</strong> <code>MU#{char_id}#%</code> (mute)<br>
<strong>Server:</strong> <code>UM#{char_id}#%</code> (unmute)</p><p>Shows an overlay on the client using <code>char_id</code> that indicates that they are muted.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="master-server-protocol">Master server protocol<a class="hash-link" href="#master-server-protocol" title="Direct link to heading">â€‹</a></h2><table><thead><tr><th>Function</th><th>Message</th><th>Direction</th></tr></thead><tbody><tr><td>Chat</td><td><code>CT#[username]#[message]#%</code></td><td>Server</td></tr><tr><td>Version check</td><td><code>VC#%</code></td><td>Server</td></tr><tr><td>Client version (AO2)</td><td><code>ID#[client software]#[version]#%</code></td><td>Server</td></tr><tr><td>Hard drive ID (or anything in practice)</td><td><code>HI#[hdid]#%</code></td><td>Server</td></tr><tr><td>Get all servers (AO2)</td><td><code>ALL#%</code></td><td>Server</td></tr><tr><td>Server entry (paginated) (AO1)</td><td><code>SN#[entry number]#[ip]#[server version]#[port]#[name]#[desc]#%</code></td><td>Client</td></tr><tr><td>Server entry (all) (AO2)</td><td><code>ALL#[[name]&amp;[desc]&amp;[ip]&amp;[port]#]%</code></td><td>Client</td></tr><tr><td>Server version</td><td><code>SV#[version]#%</code></td><td>Client</td></tr><tr><td>Ping</td><td><code>PING#%</code></td><td>Server</td></tr><tr><td>Server not advertised (reply to ping)</td><td><code>NOSERV#%</code></td><td>Advertiser</td></tr><tr><td>Heartbeat</td><td><code>SCC#[port]#[name]#[description]#[server software]#%</code></td><td>Server</td></tr><tr><td>Heartbeat success</td><td><code>PSDD#0#%</code></td><td>Advertiser</td></tr><tr><td>Keepalive</td><td><code>CHECK#%</code></td><td>Advertiser</td></tr><tr><td>Global ban</td><td><code>DOOM#%</code></td><td>Client</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="paginated-list-obsolete">Paginated list (obsolete)<a class="hash-link" href="#paginated-list-obsolete" title="Direct link to heading">â€‹</a></h3><p><strong>Client:</strong> <code>askforservers#%</code> (returns first server on the list starting from 0)<br>
<strong>Server:</strong> first server<br>
<strong>Client:</strong> <code>SR#{n}#%</code><br>
<strong>Server:</strong> server of index <code>n</code></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="evidence-list-1">Evidence list<a class="hash-link" href="#evidence-list-1" title="Direct link to heading">â€‹</a></h3><p><strong>Client:</strong> <code>RE#%</code></p><p>Clients had a packet to request the server evidence list. However, this is deprecated and unused.</p><hr><p>Thanks to stonedDiscord and Aleks for initial AO1 reverse engineering; OmniTroid for AO2 protocol documentation; and Cerapter for 2.6 protocol documentation.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/AttorneyOnline/AODocs/docs/Development/Network.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/AODocs/Authoring/misc"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">misc</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/AODocs/Development/Roadmap"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Roadmap</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#network-protocol" class="table-of-contents__link toc-highlight">Network Protocol</a><ul><li><a href="#handshake" class="table-of-contents__link toc-highlight">Handshake</a></li><li><a href="#character-selection" class="table-of-contents__link toc-highlight">Character selection</a></li><li><a href="#in-character-commands" class="table-of-contents__link toc-highlight">In-character commands</a></li><li><a href="#out-of-character-message" class="table-of-contents__link toc-highlight">Out-of-character message</a></li><li><a href="#evidence" class="table-of-contents__link toc-highlight">Evidence</a></li><li><a href="#areas" class="table-of-contents__link toc-highlight">Areas</a></li><li><a href="#casing" class="table-of-contents__link toc-highlight">Casing</a></li><li><a href="#moderator-commands" class="table-of-contents__link toc-highlight">Moderator commands</a></li><li><a href="#keep-alive" class="table-of-contents__link toc-highlight">Keep alive</a></li><li><a href="#subtheme-switching" class="table-of-contents__link toc-highlight">Subtheme switching</a></li><li><a href="#timers" class="table-of-contents__link toc-highlight">Timers</a></li><li><a href="#judge-controls" class="table-of-contents__link toc-highlight">Judge controls</a></li><li><a href="#escape-codes" class="table-of-contents__link toc-highlight">Escape codes</a></li><li><a href="#obsolete" class="table-of-contents__link toc-highlight">Obsolete</a></li></ul></li><li><a href="#master-server-protocol" class="table-of-contents__link toc-highlight">Master server protocol</a><ul><li><a href="#paginated-list-obsolete" class="table-of-contents__link toc-highlight">Paginated list (obsolete)</a></li><li><a href="#evidence-list-1" class="table-of-contents__link toc-highlight">Evidence list</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"></div></footer></div>
<script src="/AODocs/assets/js/runtime~main.a5d2275f.js"></script>
<script src="/AODocs/assets/js/main.345a0c90.js"></script>
</body>
</html>